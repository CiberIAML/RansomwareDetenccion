<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Deteccion de Ransomware</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Estilos Globales */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Asegura que el body ocupe toda la altura */

            /* --- Nuevos Estilos de Fondo --- */
            /* Imagen de fondo de ciberseguridad (URL p√∫blica de placeholder) */
            background-image: url('https://placehold.co/1920x1080/1a1a2e/ffffff?text=CYBER+SECURITY+BACKGROUND');
            background-size: cover; /* Asegura que la imagen cubra todo el fondo */
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed; /* Mantiene la imagen fija al hacer scroll */
            background-color: #1a1a2e; /* Color de fallback */
            /* --------------------------------- */
        }

        /* Contenedor Principal */
        .container {
            /* --- Contenedor Semi-Transparente --- */
            background-color: rgba(255, 255, 255, 0.9); /* Fondo blanco 90% opaco */
            /* ------------------------------------ */
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Sombra m√°s pronunciada para contraste */
            max-width: 950px; /* Ancho para las dos columnas */
            width: 100%;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        /* Tarjetas de Opci√≥n (Subir Archivo y Entrada Manual) */
        .card {
            background-color: rgba(255, 255, 255, 0.95); /* Ligeramente m√°s opaco que el contenedor principal */
            padding: 20px;
            border: 1px solid rgba(204, 204, 204, 0.5); /* Borde semi-transparente */
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
            background-color: rgba(255, 255, 255, 0.9); /* Fondo para el t√≠tulo para mejor legibilidad */
            padding: 10px;
            border-radius: 8px;
        }

        /* Contenedor de Opciones (Dos Columnas) */
        .option-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        @media (min-width: 768px) {
            .option-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        input[type="file"],
        input[type="number"],
        button {
            padding: 10px;
            width: 100%;
            margin-top: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        /* Estilos de Botones */
        .btn-primary {
            background: #007bff;
            border: none;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            border: none;
            color: white;
            cursor: pointer;
            margin-top: 5px;
            transition: background 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }

        /* √Årea de resultado */
        #result-container {
            margin-top: 20px;
            padding: 20px;
            background-color: rgba(240, 240, 240, 0.95); /* Semi-transparente */
            border-radius: 8px;
            border: 1px solid #ddd;
            word-wrap: break-word;
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* Estilo para el pie de p√°gina */
        footer {
            margin-top: 30px;
            padding: 10px;
            text-align: center;
            width: 100%;
            max-width: 950px;
            color: #fff; /* Texto blanco para el fondo oscuro */
            background-color: rgba(0, 0, 0, 0.6); /* Fondo semi-transparente oscuro */
            border-radius: 8px;
        }

    </style>
</head>

<body>
    <div class="container">
        <h1>üîê Clasificador de Ransomware (An√°lisis PE)</h1>
        <p style="text-align: center; font-style: italic;">Sube un archivo ejecutable (EXE) o ingresa los valores de las caracter√≠sticas PE manualmente.</p>

        <div class="option-container">

            <!-- Columna 1: Subir Archivo -->
            <div class="card">
                <h2>üìÅ Subir archivo PE</h2>
                <form id="file-upload-form">
                    <input type="file" id="fileInput" accept=".exe, .dll">
                    <button class="btn-primary" type="button" onclick="uploadFile()">Clasificar Archivo</button>
                    <button class="btn-secondary" type="reset" onclick="clearFileForm()">Limpiar</button>
                </form>
            </div>

            <!-- Columna 2: Entrada Manual -->
            <div class="card">
                <h2>‚úèÔ∏è Entrada Manual (Caracter√≠sticas PE)</h2>
                <form id="manual-input-form">
                    <div id="manualFields" class="grid-form">
                        <!-- Los campos se insertar√°n aqu√≠ por JavaScript -->
                    </div>
                    <button class="btn-primary" type="button" onclick="predictManual()">Clasificar Manualmente</button>
                    <button class="btn-secondary" type="reset" onclick="clearManualForm()">Limpiar</button>
                </form>
            </div>
        </div>

        <!-- √Årea de Resultados -->
        <div id="result-container">
            <h2>Resultado de la Predicci√≥n</h2>
            <!-- Este div muestra la predicci√≥n de Flask si se usa el backend de Flask/Jinja,
                 pero en este entorno de prueba, usaremos solo el ID para el JSON de FastAPI -->
            <pre id="result">Esperando an√°lisis...</pre>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Detecci√≥n de Ransomware en Archivos Ejecutables de Windows PE. Modelo de Machine Learning para fines acad√©micos y de prueba.</p>
    </footer>

    <script>
        // La URL de la API de FastAPI se asume accesible en el puerto 8000 en un entorno local,
        // o en la misma ra√≠z si est√° desplegado.
        const API_URL = ""; // Si la API est√° en el mismo dominio
        
        const fields = [
            "Machine", "DebugSize", "DebugRVA", "MajorImageVersion", "MajorOSVersion",
            "ExportRVA", "ExportSize", "IatVRA", "MajorLinkerVersion", "MinorLinkerVersion",
            "NumberOfSections", "SizeOfStackReserve", "DllCharacteristics", "ResourceSize",
            "BitcoinAddresses"
        ];

        window.onload = () => {
            let html = "";
            fields.forEach(f => {
                html += `<label for="${f}">${f}</label>
                 <input type="number" id="${f}" placeholder="Ingresa el valor de ${f}" value="0">`;
            });
            document.getElementById("manualFields").innerHTML = html;
        };

        // Funci√≥n auxiliar para mostrar un mensaje personalizado en lugar de alert()
        function showMessage(message, type = 'info') {
            const resultContainer = document.getElementById('result-container');
            resultContainer.innerHTML = `
                <h2>Mensaje</h2>
                <div style="padding: 15px; border-radius: 8px; margin-top: 10px; 
                            background-color: ${type === 'error' ? '#f8d7da' : '#d1ecf1'};
                            color: ${type === 'error' ? '#721c24' : '#0c5460'};
                            border: 1px solid ${type === 'error' ? '#f5c6cb' : '#bee5eb'};">
                    ${message}
                </div>
            `;
        }

        // Funci√≥n para subir y clasificar un archivo
        async function uploadFile() {
            const fileInput = document.getElementById("fileInput");
            if (!fileInput.files.length) return showMessage("Por favor, selecciona un archivo EXE o DLL para clasificar.", 'error');
            
            showMessage("Clasificando archivo... por favor espera.");

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            try {
                const res = await fetch(`${API_URL}/predict`, {
                    method: "POST",
                    body: formData
                });

                const data = await res.json();
                
                if (res.status !== 200) {
                     showMessage(`Error en la API: ${data.error || 'Desconocido'}`, 'error');
                     return;
                }
                
                const predictionLabel = data.prediction === 'benign' 
                    ? `‚úÖ Archivo Benigno (Puntuaci√≥n: ${data.prediction})` 
                    : `üî¥ ¬°POSIBLE MALWARE! (Ransomware) (Puntuaci√≥n: ${data.prediction})`;

                document.getElementById("result").innerHTML = `
                    <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: ${data.prediction === 'benign' ? 'green' : 'red'};">
                        ${predictionLabel}
                    </div>
                    <strong>Caracter√≠sticas PE extra√≠das:</strong>
                    <pre style="background: #f3f3f3; padding: 15px; border-radius: 8px;">${JSON.stringify(data.features, null, 2)}</pre>
                `;
            } catch (e) {
                showMessage(`Error de conexi√≥n o proceso: ${e.message}. Aseg√∫rate de que el backend est√° corriendo.`, 'error');
            }
        }

        // Funci√≥n para clasificar valores manuales
        async function predictManual() {
            const payload = {};
            let allFieldsValid = true;
            
            fields.forEach(f => {
                const value = document.getElementById(f).value;
                const numValue = Number(value);
                
                if (value === "" || isNaN(numValue)) {
                    allFieldsValid = false;
                }
                payload[f] = numValue;
            });
            
            if (!allFieldsValid) return showMessage("Por favor, completa todos los 15 campos num√©ricos para la clasificaci√≥n manual.", 'error');
            
            showMessage("Clasificando valores manuales... por favor espera.");


            try {
                const res = await fetch(`${API_URL}/predict_manual`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();
                
                if (res.status !== 200) {
                     showMessage(`Error en la API: ${data.error || 'Desconocido'}`, 'error');
                     return;
                }
                
                const predictionLabel = data.prediction === 'benign' 
                    ? `‚úÖ Resultado Benigno (Puntuaci√≥n: ${data.prediction})` 
                    : `üî¥ ¬°POSIBLE MALWARE! (Ransomware) (Puntuaci√≥n: ${data.prediction})`;

                document.getElementById("result").innerHTML = `
                    <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: ${data.prediction === 'benign' ? 'green' : 'red'};">
                        ${predictionLabel}
                    </div>
                    <strong>Caracter√≠sticas PE enviadas:</strong>
                    <pre style="background: #f3f3f3; padding: 15px; border-radius: 8px;">${JSON.stringify(data.features, null, 2)}</pre>
                `;

            } catch (e) {
                showMessage(`Error de conexi√≥n o proceso: ${e.message}. Aseg√∫rate de que el backend est√° corriendo.`, 'error');
            }
        }

        function clearFileForm() {
            document.getElementById('file-upload-form').reset();
            showMessage("Archivos limpiados. Esperando nuevo an√°lisis...");
        }

        function clearManualForm() {
            document.getElementById('manual-input-form').reset();
            showMessage("Campos de entrada manual limpiados. Esperando nuevo an√°lisis...");
        }
    </script>

</body>

</html>
